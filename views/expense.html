<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/expense.css" />
    <title>Expense Tracker</title>
  </head>
  <body>
    <div id="container">
      <form action="/expense" method="post">
        <div class="mb-3">
          <label for="amount" class="form-label"
            >Choose an Expense Amount</label
          >
          <input
            type="number"
            id="amount"
            name="amount"
            class="form-control"
            placeholder="Choose an expense"
          />
        </div>
        <div class="mb-3">
          <label for="description" class="form-label"
            >Enter the Description:</label
          >
          <input
            type="text"
            id="description"
            name="description"
            class="form-control"
            placeholder="Enter the Description"
          />
        </div>
        <div class="mb-3">
          <label for="category" class="form-label">Choose a category:</label>
          <select
            id="category"
            name="category"
            class="form-select"
            id="category"
          >
            <option value="food">Food</option>
            <option value="petrol">Petrol</option>
            <option value="salary">Salary</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary" id="button">
          Add Expenses
        </button>
        <div id="buyPremier" style="color: orangered">
          <button id="buyButton" class="btn btn-success">Buy Premium</button>
          <p id="primeMessage" style="display: none;">You are a Prime Member now!</p>
        </div>
        
      </form>
      <div id="container1"></div>
    </div>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      
      let container = document.getElementById("container1");
      container.innerHTML = "";

      const form = document.querySelector("form");
      form.addEventListener("submit", function (event) {
        event.preventDefault();

        const amount = document.getElementById("amount").value;
        const description = document.getElementById("description").value;
        const category = document.getElementById("category").value;

        const data = {
          amount: amount,
          description: description,
          category: category,
        };
        let token = localStorage.getItem("token");
        axios
          .post("/expense", data, { headers: { Authorization: token } }) // Modify the URL endpoint according to your API route
          .then((response) => {
            console.log("Expense added successfully:");
            // You can update the UI or take other actions as needed
          })
          .catch((error) => {
            console.error("Error adding expense:", error);
            // Handle errors and show error messages if needed
          });
      });
      let token = localStorage.getItem("token");
      axios
        .get("/get-all-expense", { headers: { Authorization: token } })
        .then((response) => {
          let expenses = response.data;

          let ul = document.createElement("ul");
          ul.className = "list-group";

          expenses.forEach((expense) => {
            let li = document.createElement("li");
            li.className = "list-group-item";

            let deleteBtn = document.createElement("button");
            deleteBtn.className = "btn btn-danger";
            deleteBtn.textContent = "delete";

            let n = ` ${expense.amount} - ${expense.description} - ${expense.category}`;
            li.textContent = n;

            li.appendChild(deleteBtn);
            ul.appendChild(li);
            container.appendChild(ul);

            var deleteUrl = "/expense/" + expense.id;

            deleteBtn.addEventListener("click", function (event) {
              event.preventDefault();
              axios
                .delete(deleteUrl)
                .then((response) => {
                  console.log("deleted");
                  ul.removeChild(li);
                  console.log("Expense deleted successfully:", response.data);
                })
                .catch((err) => console.log(err));
            });
          });
        })
        .catch((err) => console.log(err));
        <!-- ... Rest of your HTML ... -->

 

  document.addEventListener("DOMContentLoaded", async () => {
    const token = localStorage.getItem("token");
    try {
      const response = await axios.get("/user/get-user", {
        headers: { Authorization: token },
      });

  
      const isPremiumUser = response.data.isPremiumUser;
      console.log(isPremiumUser);
      const buyPremier = document.getElementById("buyPremier");
      const buyButton = document.getElementById("buyButton");
      const primeMessage = document.getElementById("primeMessage");

      if (isPremiumUser) {
        buyButton.style.display = "none";
        primeMessage.style.display = "block";
      } else {
        buyButton.style.display = "block"; // Display the "Buy Premium" button
        primeMessage.style.display = "none";
      }

    buyButton.addEventListener("click", async (e) => {
      const token = localStorage.getItem("token");
      const response = await axios.get("/purchase/premiummembership", {
        headers: { Authorization: token },
      });
      const options = {
        key: response.data.key_id,
        order_id: response.data.order.id,
        handler: async function (response) {
          try {
            const updateResponse = await axios.post(
              "/purchase/updatetransaction",
              {
                orderid: options.order_id,
                paymentid: response.razorpay_payment_id,
              },
              { headers: { Authorization: token } }
            );

            localStorage.setItem("isPremiumeUser", "true");
            buyButton.style.display = "none";
            primeMessage.style.display = "block";

            alert("Payment Successful! You are now a Prime Member.");
          } catch (error) {
            console.error(error);
            alert("Something went wrong with the payment.");
          }
        },
      };
      const rzp1 = new Razorpay(options);
      rzp1.open();
      e.preventDefault();
    });
       
      
    }catch(error){
      console.log(error);
    }
  });
</script>
 

  </body>
</html>
